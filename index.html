<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="1x1.png">
    <title>DISKK</title>
</head>
<body>

    <div class="circle">

    </div>

    <div class="belowtxt">
        <p class="button" onclick="playsong()">play</p>
        <br><br>
        <p class="button" onclick="pausesong()">pause</p>
        <br><br>
        <div class="file-input-container">
            <label for="fileInput" class="file-input-label">choose mp3 file</label>
            <input type="file" accept="audio/mp3" id="fileInput" onchange="selecionarArq(event)">
        </div>
        <br><br>
        <p>drag the disk to control</p>
    </div>
</body>
<script>
    let audio;
    let selectedFile;
    let lastPlaybackPosition = 0;
    let isDragging = false;

    document.querySelector('.circle').addEventListener('mousedown', startDragging);
    document.addEventListener('mousemove', handleDragging);
    document.addEventListener('mouseup', stopDragging);
    
    function startDragging(e) {
        isDragging = true;
        document.querySelector('.circle').classList.add('dragging');
    }
    
    function handleDragging(e) {
        if (isDragging) {
            const deltaX = e.clientX - initialMouseX;
    
            const percentage = (deltaX / circleWidth) * 100;
    
            const timeChange = (percentage / 100) * audio.duration;
    
            audio.currentTime += timeChange;
    
            initialMouseX = e.clientX;
        }
    }
    
    function stopDragging() {
        isDragging = false;
        document.querySelector('.circle').classList.remove('dragging');
    }
    
    let initialMouseX = 0;
    let circleWidth = 400;

    function playsong() {
        if (selectedFile) {
            if (!audio) {
                audio = new Audio();
                audio.addEventListener('timeupdate', updatePlaybackPosition);
            }

            if (lastPlaybackPosition > 0) {
                audio.currentTime = lastPlaybackPosition;
            } else {
                let objectURL = URL.createObjectURL(selectedFile);
                audio.src = objectURL;
            }

            audio.play();
            var circle = document.querySelector('.circle');
            circle.style.animation = 'rotate 2s linear infinite, pulse 2s ease-in-out infinite';
        } else {
            alert("Please select an MP3 file first.");
        }
    }

    function pausesong() {
        if (audio) {
            audio.pause();
            lastPlaybackPosition = audio.currentTime;
            var circle = document.querySelector('.circle');
            circle.style.animation = '';
        }
    }

    function updatePlaybackPosition() {
        if (audio) {
            lastPlaybackPosition = audio.currentTime;
        }
    }

    function selecionarArq(event) {
        const fileInput = event.target;
        selectedFile = fileInput.files[0];
    }
</script>

</html>